'use strict';

/**
 * DIRECTIVE TIMER
 */
angular.module('snapApp')
	.directive('timer', ['$compile', function ($compile) {
		return  {
			restrict: 'EAC',
			replace: false,
			scope: {
				countdownattr: '=countdown',
				message: '@msg'
			},
			controller: ['$scope', '$element', '$attrs', '$timeout', 'messageService', function ($scope, $element, $attrs, $timeout, messageService) {
				//Insert scope into directive
				$element.append($compile($element.contents())($scope));

				var _interval = 1000,
						countdown = $scope.countdownattr,
						messageID = $scope.message;

				$scope.countdown = countdown;

				var countUp = function() {
						$scope.countdown -= 1;

						var timer = $timeout(countUp, --_interval);

						if ($scope.countdown === 0) {
							//Stop the timer
							$timeout.cancel(timer);
							//API REQUEST
							messageService.deleteMessage(messageID).then(function(message) {
								console.log(message);
							});
						};
				};

				$timeout(countUp, --_interval);

			}]}
	}]);
