'use strict';

/**
 * DIRECTIVE SLDIER
 */
angular.module('snapApp')
	.directive('slider', ['$compile', function ($compile) {
		return  {
			restrict: 'EAC',
			replace: false,
			scope: {
				maxAttr: '=max',
				widthAttr: '=width'
			},
			template: '<div class="slider__row" style="width: {{ width }}px"><button type="button"></button><span class="time"></span></div>',
			controller: ['$scope', '$element', '$attrs', '$document', function ($scope, $element, $attrs, $document) {
				var startX = 0, x = 0;
				var btnSlider = $element.find('button'),
					sliderWidth = $scope.widthAttr;

				//Set the slider width
				$scope.width = sliderWidth;

				btnSlider.on('mousedown', function(event) {
					event.preventDefault();
					startX = (event.pageX - this.offsetLeft);
					$document.on('mousemove', mousemove);
				});

				function mousemove(event) {
					var currentPosition = event.pageX - startX;

					btnSlider.css({left:  currentPosition + 'px'});

					if (currentPosition <= 0){
		                btnSlider.css({left:  0 + 'px'});
		                currentPosition = 0;
		            } else if(currentPosition >= sliderWidth){
		                btnSlider.css({left:  sliderWidth + 'px'});
		                currentPosition = sliderWidth;
		            };

		            angular.element(document.querySelector('.time')).text(currentPosition)
				};

				$document.on('mouseup', function() {
					$document.off('mousemove', mousemove);
				});
			}]
		};
	}]);
